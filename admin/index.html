<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Trendeals Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="../assets/js/supabase.js"></script>

<style>
/* ðŸ”’ ALL YOUR ORIGINAL CSS â€” UNCHANGED */
:root { --purple:#8e44ad; --bg:#faf6fb; }
*{ box-sizing:border-box; font-family:Arial, sans-serif; margin:0; padding:0 }
body{ background:var(--bg); }
  .preview img {
  width: 70px;
  height: 70px;
  object-fit: cover;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.preview div {
  position: relative;
}

.preview span {
  position: absolute;
  top: -6px;
  right: -6px;
  background: red;
  color: #fff;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

/* header */
.header{height:60px;background:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 20px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
.logo{font-size:22px;font-weight:800}
.logo span{color:var(--purple)}
.hamburger{width:40px;height:40px;border-radius:10px;background:#f2f2f2;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:22px}
/* sidebar */
.sidebar{position:fixed;right:-260px;top:0;width:260px;height:100%;background:#fff;padding:20px;transition:.3s;z-index:1001}
.sidebar.active{right:0}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;z-index:1000}
.overlay.active{display:block}
/* main */
.container{padding:30px}
.top-bar{display:flex;justify-content:space-between;align-items:center}
.add-btn{background:var(--purple);color:#fff;border:none;padding:12px 18px;border-radius:12px;font-weight:700}
.products{margin-top:25px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px}
/* card */
.card{background:#fff;border-radius:16px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
.card img{width:100%;height:150px;object-fit:cover;border-radius:12px}
.actions{display:flex;gap:8px;margin-top:10px}
/* modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:2000}
.modal.active{display:flex}
.modal-box{background:#fff;width:460px;max-width:92%;max-height:85vh;overflow-y:auto;border-radius:18px;padding:24px}
.save-btn{background:var(--purple);color:#fff;width:100%;padding:14px;border:none;border-radius:14px;font-weight:700}
/* login overlay */
#loginOverlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:5000}
</style>
</head>

<body>

<!-- LOGIN OVERLAY -->
<div id="loginOverlay">
  <div style="background:#fff;width:360px;padding:24px;border-radius:16px">
    <h2 style="text-align:center;margin-bottom:15px">Admin Login</h2>
    <input id="adminEmail" placeholder="Email" style="width:100%;padding:12px;margin-bottom:10px">
    <input id="adminPassword" type="password" placeholder="Password" style="width:100%;padding:12px;margin-bottom:15px">
    <button onclick="adminLogin()" style="width:100%;padding:12px;background:#8e44ad;color:#fff;border:none;border-radius:10px;font-weight:700">Login</button>
    <p id="loginError" style="color:red;text-align:center;margin-top:10px"></p>
  </div>
</div>

<!-- ADMIN UI -->
<div id="adminApp" style="display:none">

<div class="header">
  <div class="logo">TREN<span>DEALS</span></div>
  <div class="hamburger" onclick="toggleMenu()">â˜°</div>
</div>

<div class="sidebar" id="sidebar">
  <button onclick="toggleMenu()">Close</button>
  <button onclick="logout()">Logout</button>
</div>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="container">
  <div class="top-bar">
    <h2>Products</h2>
    <button class="add-btn" onclick="openModal()">+ Add Product</button>
  </div>
  <div class="products" id="products"></div>
</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <input id="name" placeholder="Product Name"> <input id="price" type="number" placeholder="Price">
 <input id="category" placeholder="Category"> <input id="sizes" placeholder="Sizes (S,M,L)"> <input id="colors" placeholder="Colors (Red,Blue)"> <label>Cover Image</label> <input type="file" id="coverImage"> <div class="preview" id="coverPreview"></div> <label>Gallery Images</label> <input type="file" id="galleryImages" multiple> <div class="preview" id="galleryPreview"></div> <button type="button" class="save-btn" onclick="saveProduct()"> Save Product </button>
  </div>
</div>

</div>

<script>
const client = window.supabaseClient;

document.addEventListener("DOMContentLoaded", checkAdminSession);

async function checkAdminSession(){
  const { data } = await client.auth.getSession();
  if(data.session){
    loginOverlay.style.display="none";
    adminApp.style.display="block";
    loadProducts();
  }else{
    loginOverlay.style.display="flex";
    adminApp.style.display="none";
  }
}

async function adminLogin(){
  const email = adminEmail.value.trim();
  const password = adminPassword.value.trim();

  const { error } = await client.auth.signInWithPassword({ email, password });
  if(error){
    loginError.textContent = error.message;
    return;
  }
  checkAdminSession();
}

async function logout(){
  await client.auth.signOut();
  location.reload();
}

function toggleMenu(){
  sidebar.classList.toggle("active");
  overlay.classList.toggle("active");
}

function openModal(){ modal.classList.add("active"); }
function closeModal(){ modal.classList.remove("active"); }

async function loadProducts(){
  const { data } = await client.from("products").select("*").order("created_at",{ascending:false});
  products.innerHTML="";
  data?.forEach(p=>{
    products.innerHTML+=`
      <div class="card">
        <img src="${p.cover_image||""}">
        <h4>${p.name}</h4>
        <p>â‚¹${p.price}</p>
      </div>`;
  });
}

async function saveProduct() {
  try {
    const nameValue = (name.value || "").trim();
    const categoryValue = (category.value || "").trim();
    const priceValue = (price.value || "").trim();

    const payload = {
      name: nameValue,
      category: categoryValue,
      price: priceValue === "" ? null : Number(priceValue),
      sizes: sizes.value
        ? sizes.value.split(",").map(s => s.trim()).filter(Boolean)
        : [],
      colors: colors.value
        ? colors.value.split(",").map(c => c.trim()).filter(Boolean)
        : [],
      available: true
    };

    // âœ… Proper validation
    if (!payload.name || !payload.category || payload.price === null || payload.price <= 0) {
      alert("Fill required fields");
      return;
    }

    const { error } = await client.from("products").insert(payload);
    if (error) throw error;

    closeModal();
    loadProducts();

  } catch (err) {
    console.error("Save failed:", err);
    alert("Failed to save product");
  }
}


</script>

  

</body>
</html>





