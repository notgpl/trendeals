<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trendeals Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      max-width: 500px;
      margin: auto;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
    }
    .product {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>Admin Login</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- ADMIN PANEL -->
<div id="panel" class="hidden">
  <h2>Admin Panel</h2>

  <button onclick="logout()">Logout</button>

  <h3>Add Product</h3>
  <input id="name" placeholder="Name">
  <input id="price" placeholder="Price">
  <input id="category" placeholder="Category">
  
  <label>Cover Image</label>
<input id="coverImage" type="file" accept="image/*">

<label>Product Images (Gallery)</label>
<input id="galleryImages" type="file" accept="image/*" multiple>
  
  <button onclick="addProduct()">Add Product</button>

  <h3>Products</h3>
  <div id="products"></div>
</div>

<script>
  // ðŸ”‘ SUPABASE CONFIG
  const SUPABASE_URL = "https://ctiglwnyimjzocvuizdq.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0aWdsd255aW1qem9jdnVpemRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNDI4MTMsImV4cCI6MjA4MTYxODgxM30.eW5nl5yCXnz0V0iya6cZCMj4Pgy05vhClUQ4pLfwYNI";

  const client = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
  );

  async function uploadSingleImage(file) {
  const fileName = `cover-${Date.now()}-${file.name}`;

  const { error } = await client.storage
    .from("products")
    .upload(fileName, file);

  if (error) throw error;

  return client.storage
    .from("products")
    .getPublicUrl(fileName).data.publicUrl;
}

async function uploadGalleryImages(files) {
  const urls = [];

  for (const file of files) {
    const fileName = `gallery-${Date.now()}-${file.name}`;

    const { error } = await client.storage
      .from("products")
      .upload(fileName, file);

    if (error) throw error;

    const { data } = client.storage
      .from("products")
      .getPublicUrl(fileName);

    urls.push(data.publicUrl);
  }

  return urls;
}


  const loginBox = document.getElementById("loginBox");
  const panel = document.getElementById("panel");

  // ðŸ” Restore session on refresh
  document.addEventListener("DOMContentLoaded", async () => {
    const { data } = await client.auth.getSession();
    if (data.session) {
      showPanel();
      loadProducts();
    }
  });

  // ðŸ” LOGIN
  async function login() {
    const { error } = await client.auth.signInWithPassword({
      email: email.value,
      password: password.value
    });

    if (error) {
      alert(error.message);
      return;
    }

    showPanel();
    loadProducts();
  }

  // ðŸ”“ LOGOUT
  async function logout() {
    await client.auth.signOut();
    location.reload();
  }

  function showPanel() {
    loginBox.classList.add("hidden");
    panel.classList.remove("hidden");
  }

  // ðŸ“¦ LOAD PRODUCTS
  async function loadProducts() {
    const { data, error } = await client
      .from("products")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      alert(error.message);
      return;
    }

    const box = document.getElementById("products");
    box.innerHTML = "";

    data.forEach(p => {
      box.innerHTML += `
        <div class="product">
          <b>${p.name}</b> â€“ â‚¹${p.price}<br><br>
          <button onclick="toggleAvailability('${p.id}', ${!p.available})">
            ${p.available ? "Disable" : "Enable"}
          </button>
          <button onclick="removeProduct('${p.id}')">
            Delete
          </button>
        </div>
      `;
    });
  }

  // âž• ADD PRODUCT
 async function addProduct() {
  const name = document.getElementById("name").value.trim();
  const price = document.getElementById("price").value.trim();
  const category = document.getElementById("category").value.trim();
  const coverInput = document.getElementById("coverImage");
  const galleryInput = document.getElementById("galleryImages");

  if (!name || !price || !category || coverInput.files.length === 0) {
    alert("Fill all fields correctly");
    return;
  }

  try {
    // upload cover
    const coverUrl = await uploadSingleImage(coverInput.files[0]);

    // upload gallery (MULTIPLE)
    const galleryUrls = galleryInput.files.length
      ? await uploadGalleryImages(galleryInput.files)
      : [];

    const { error } = await client.from("products").insert({
      name,
      price: Number(price),
      category,
      cover_image: coverUrl,
      images: galleryUrls,
      sizes: [],
      colors: [],
      available: true
    });

    if (error) throw error;

    // reset form
    document.getElementById("name").value = "";
    document.getElementById("price").value = "";
    document.getElementById("category").value = "";
    coverInput.value = "";
    galleryInput.value = "";

    loadProducts();
  } catch (err) {
    console.error(err);
    alert(err.message);
  }
}


</script>

</body>
</html>





