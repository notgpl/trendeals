<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Trendeals Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --purple:#8e44ad;
  --bg:#faf5fb;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--bg);
}

/* HEADER */
header{
  background:#fff;
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 5px 20px rgba(0,0,0,.05);
}
.logo{font-weight:800;font-size:22px}
.logo span{color:var(--purple)}
.hamburger{
  font-size:22px;
  background:none;
  border:none;
  cursor:pointer;
}

/* SIDE MENU */
.side-menu{
  position:fixed;
  right:0; top:0;
  height:100%;
  width:220px;
  background:#fff;
  padding:20px;
  box-shadow:-5px 0 20px rgba(0,0,0,.2);
  z-index:20;
}
.side-menu button{
  width:100%;
  padding:12px;
  margin-top:10px;
}
.hidden{display:none}

/* MAIN */
main{padding:20px}
.products-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.fab{
  background:var(--purple);
  color:#fff;
  border:none;
  border-radius:12px;
  padding:12px 18px;
  font-size:16px;
  cursor:pointer;
}

/* PRODUCT CARD */
.product{
  background:#fff;
  padding:12px;
  border-radius:12px;
  margin-top:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.product button{margin-left:6px}

/* MODAL */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  z-index:9;
}
.modal{
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  width:95%; max-width:420px;
  background:#fff;
  border-radius:18px;
  z-index:10;
  padding:16px;
}
.modal-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.modal-header button{
  background:none;border:none;font-size:18px;cursor:pointer;
}
.modal-body input{
  width:100%;
  padding:10px;
  margin:6px 0;
}
.save-btn{
  background:var(--purple);
  color:#fff;
  border:none;
  padding:12px;
  width:100%;
  border-radius:12px;
  margin-top:10px;
}

/* IMAGE PREVIEW */
.preview-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  margin-top:8px;
}
.preview{
  position:relative;
}
.preview img{
  width:100%;
  border-radius:8px;
}
.preview button{
  position:absolute;
  top:4px; right:4px;
  background:red;
  color:white;
  border:none;
  border-radius:50%;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <div class="logo">TREN<span>DEALS</span></div>
  <button class="hamburger" onclick="toggleMenu()">☰</button>
</header>

<div id="sideMenu" class="side-menu hidden">
  <button onclick="toggleMenu()">✕ Close</button>
  <button onclick="logout()">Logout</button>
</div>

<main>
  <div class="products-header">
    <h2>Products</h2>
    <button class="fab" onclick="openAdd()">＋ Add Product</button>
  </div>
  <div id="products"></div>
</main>

<!-- MODAL -->
<div id="overlay" class="overlay hidden" onclick="closeModal()"></div>

<div id="productModal" class="modal hidden">
  <div class="modal-header">
    <button onclick="closeModal()">←</button>
    <h3 id="modalTitle">Add Product</h3>
    <button onclick="closeModal()">✕</button>
  </div>

  <div class="modal-body">
    <input type="hidden" id="editId">
    <input id="name" placeholder="Product Name">
    <input id="price" placeholder="Price">
    <input id="category" placeholder="Category">
    <input id="sizes" placeholder="Sizes (S,M,L)">
    <input id="colors" placeholder="Colors (Red,Blue)">

    <label>Cover Image</label>
    <input type="file" id="coverImage" accept="image/*">
    <div id="coverPreview"></div>

    <label>Gallery Images</label>
    <input type="file" id="galleryImages" multiple accept="image/*">
    <div id="galleryPreview" class="preview-grid"></div>

    <button class="save-btn" onclick="saveProduct()">Save Product</button>
  </div>
</div>

<script>
/* ================= SUPABASE ================= */
const SUPABASE_URL="https://ctiglwnyimjzocvuizdq.supabase.co";
const SUPABASE_KEY="YOUR_ANON_KEY";
const client=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

/* ================= MENU ================= */
function toggleMenu(){
  sideMenu.classList.toggle("hidden");
}

/* ================= MODAL ================= */
function openModal(){
  overlay.classList.remove("hidden");
  productModal.classList.remove("hidden");
}
function closeModal(){
  overlay.classList.add("hidden");
  productModal.classList.add("hidden");
}
function openAdd(){
  modalTitle.textContent="Add Product";
  editId.value="";
  clearForm();
  openModal();
}

/* ================= IMAGE PREVIEW ================= */
let galleryFiles=[];

coverImage.onchange=()=>{
  coverPreview.innerHTML="";
  if(coverImage.files[0]){
    coverPreview.innerHTML=`<img src="${URL.createObjectURL(coverImage.files[0])}" style="width:100%;border-radius:10px">`;
  }
};

galleryImages.onchange=()=>{
  galleryFiles=[...galleryImages.files];
  renderGallery();
};

function renderGallery(){
  galleryPreview.innerHTML="";
  galleryFiles.forEach((f,i)=>{
    const div=document.createElement("div");
    div.className="preview";
    div.innerHTML=`
      <img src="${URL.createObjectURL(f)}">
      <button onclick="removeGallery(${i})">×</button>
    `;
    galleryPreview.appendChild(div);
  });
}
function removeGallery(i){
  galleryFiles.splice(i,1);
  renderGallery();
}

/* ================= PRODUCTS ================= */
async function loadProducts(){
  const {data}=await client.from("products").select("*").order("created_at",{ascending:false});
  products.innerHTML="";
  data.forEach(p=>{
    products.innerHTML+=`
      <div class="product">
        <b>${p.name}</b>
        <div>
          <button onclick='editProduct(${JSON.stringify(p)})'>Edit</button>
        </div>
      </div>
    `;
  });
}

function editProduct(p){
  modalTitle.textContent="Edit Product";
  editId.value=p.id;
  name.value=p.name;
  price.value=p.price;
  category.value=p.category;
  sizes.value=(p.sizes||[]).join(",");
  colors.value=(p.colors||[]).join(",");
  openModal();
}

/* ================= SAVE ================= */
async function saveProduct(){
  if(!name.value || !price.value || !category.value){
    alert("Fill all fields"); return;
  }

  const payload={
    name:name.value,
    price:Number(price.value),
    category:category.value,
    sizes:sizes.value.split(",").map(s=>s.trim()),
    colors:colors.value.split(",").map(c=>c.trim()),
    available:true,
    images:[]
  };

  if(editId.value){
    await client.from("products").update(payload).eq("id",editId.value);
  }else{
    await client.from("products").insert(payload);
  }

  closeModal();
  clearForm();
  loadProducts();
}

function clearForm(){
  name.value=price.value=category.value=sizes.value=colors.value="";
  coverImage.value=galleryImages.value="";
  coverPreview.innerHTML=galleryPreview.innerHTML="";
  galleryFiles=[];
}

/* ================= AUTH ================= */
async function logout(){
  await client.auth.signOut();
  location.reload();
}

document.addEventListener("DOMContentLoaded",loadProducts);
</script>

</body>
</html>
